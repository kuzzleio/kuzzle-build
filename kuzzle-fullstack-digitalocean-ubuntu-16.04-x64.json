{
  "provisioners": [
    {
      "type": "shell",
      "execute_command": "echo '{{user `ssh_pass`}}' | {{ .Vars }} sudo -E -S sh '{{ .Path }}'",
      "inline": [
        "add-apt-repository ppa:ansible/ansible",
        "apt-get update",
        "apt-get install -y ansible",
        "echo '%sudo    ALL=(ALL)  NOPASSWD:ALL' >> /etc/sudoers"
      ]
    },
    {
      "type": "ansible-local",
      "playbook_file": "../kuzzle-provisioners/kuzzle-fullstack-with-services.yml",
      "playbook_dir": "../kuzzle-provisioners/",
      "extra_arguments": ["--extra-vars", "host={{user `host`}}"]
    }
  ],
  "builders": [
    {
      "type": "digitalocean",
      "api_token": "{{user `api_token`}}",
      "snapshot_name": "kuzzle-fullstack-digitalocean-ubuntu-16.04-x64-{{timestamp}}",
      "region": "lon1",
      "size": "1gb",
      "image": "ubuntu-16-04-x64"
    }
  ]
}